┌──────────────┐
│   Пользователь │
│   (Telegram)   │
└───────┬────────┘
        │
        │ /connect
        ▼
┌──────────────────────┐
│   Telegram-бот        │
│   (aiogram)           │
│                      │
│ 1. Генерирует OAuth   │
│    ссылку Google      │
└───────┬──────────────┘
        │
        │ открывает ссылку
        ▼
┌──────────────────────┐
│   Google OAuth        │
│   Consent Screen      │
│                      │
│ Пользователь          │
│ даёт доступ Gmail     │
└───────┬──────────────┘
        │
        │ redirect_uri
        ▼
┌────────────────────────────┐
│ Backend (Flask / FastAPI)   │
│ /oauth/callback             │
│                            │
│ 2. Получает `code`          │
│ 3. Обменивает на токены     │
│ 4. Сохраняет токен          │
│    (tokens/<tg_id>.json)    │
└───────┬────────────────────┘
        │
        │ (один раз)
        ▼
┌──────────────────────┐
│   Gmail API           │
│                      │
│ Доступ разрешён       │
└──────────────────────┘


══════════ ДАЛЬШЕ ФОНОВАЯ РАБОТА ══════════


┌──────────────────────┐
│   Telegram-бот        │
│   (scheduler/task)   │
│                      │
│ 5. Загружает токен    │
│ 6. Создаёт Gmail API  │
│ 7. Проверяет письма  │
└───────┬──────────────┘
        │
        │ важное письмо
        ▼
┌──────────────────────┐
│   Telegram-бот        │
│                      │
│ 8. Отправляет         │
│    уведомление        │
└───────┬──────────────┘
        │
        ▼
┌──────────────┐
│ Пользователь │
│ Telegram     │
└──────────────┘
